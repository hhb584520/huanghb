# ONAP Setup

## 1. Perpare Environment

### 1.1 install openssh-server

	$ cat /etc/apt/apt.conf
	Acquire::http::Proxy "http://child-prc.sh.intel.com:913";

	$ apt-get install openssh-server -y

### 1.2 add sudo user
Use the adduser command to add a new user to your system.
Be sure to replace username with the user that you want to create.
	
	$ adduser username
	$ echo "{username} ALL = (root) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/{username}
	$ sudo chmod 0440 /etc/sudoers.d/{username}

## 2. Install software 

open a new terminal

	$ export http_proxy=http://child-prc.sh.intel.com:913
	$ git clone http://github.com/openstack/fuel-plugin-ovs
	$ cd fuel-plugin-ovs/demo

close this terminal

### 2.1 Install and config VNC

	$ ./02_install_packages.sh 
	$ ./03_setup_vnc.sh
	$ vncpasswd
	$ vncserver :1
	$ vnc4server -kill :1
	$ pkill vncconfig
	  vncconfig -nowin &


### 2.2 config network

	./00_bootstrap.sh

- config proxy
- install openssh-server
- install git
- install redsocks

**Config redsocks**

	$ ./01_setup_redsocks.sh
	$ onap@hstack:~$ cat /etc/resolv.conf 
		# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
		#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
		nameserver 10.248.2.1
		search sh.intel.com

	$ ssh onap@onap-1.sc.intel.com -L 1080:10.7.211.16:1080
		password: onap
	$ wget --no-proxy www.google.com  //if can upload, this is ok
    $ sudo iptables-save
    $ sudo service redsocks restart

### 2.2 Setup VirtualBox

	apt-get install -y virtualbox

### 2.3 Setup Vagrant

	$ git clone http://github.intel.com/rguo/vagrant 
	$ cd vagrant
	$ ./setup_vagrant.sh

## 3.Setup Openstack and ONAP

### 3.1 Install Openstack

	$ http://gerrit.onap.org/r/multicloud/openstack  
	$ cd openstack/ocata/vagrant/
    $ vi Vagrantfile   // change num_compute_nodes=1

	# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!
	$num_compute_nodes = 1
	
	Vagrant.configure("2") do |config|
	
	  config.vm.box = "bento/ubuntu-16.04"
	
	  config.vm.provider :virtualbox do |vb|
	    vb.customize ["modifyvm", :id, "--memory", 4096]
	    vb.customize ["modifyvm", :id, "--cpus", 4]
	    vb.customize ["modifyvm", :id, "--nicpromisc3", "allow-all"]
	    vb.customize "post-boot",["controlvm", :id, "setlinkstate1", "on"]
	  end

	
	$ vagrant status
	$ vagrant up         // install all

	Q1: how to know use config file(Vagrantfile)
	A1: you must run "vagrant up" with Vagrantfile directory.

### 3.2 Install ONAP  

**Start ONAP**

	$ vagrant up onap

**END ONAP**

	$ vagrant destroy -f onap


### 3.3 Vagrant

	$ vagrant status
	Current machine states:
	
	control                   running (virtualbox)
	compute-1                 running (virtualbox)
	onap                      running (virtualbox)
	
	This environment represents multiple VMs. The VMs are all listed
	above with their current state. For more information about a specific
	VM, run `vagrant status NAME`.

	$ vagrant ssh compute-1
	$ cd devstack
	$ vi stack.sh.log.2017-09-26-160010.summary.2017-09-26-160010

	$ vagrant ssh control
	$ bash /vagrant/create_vm.sh


## 4. Test Multi Cloud 

	$ cd openstack/ocata/vagrant/test
	$ ./test_multicloud.sh 


## 5.developer
### 5.1 Configure

	$ apt-get install git-review
	$ git clone ssh://Ruijing@gerrit.onap.org:29418/multicloud/openstack
	$ vim ~/.gitconfig
		[gitreview]
		        username = haibin
		[user]
		        name = Huang Haibin
		        email = haibin.huang@intel.com
		[core]
		        editor = vi

### 5.2 Use

	$ vim test
	$ git add test

	$ git commit -s
	$ git commit -s --amend

	  Fix interface name issue in multicloud test

	  vagrant box bento/ubuntu-16.04 change interface name,
      which case regression

	  Issue-ID: MULTICLOUD-57
     
      jira.onap.org can create issue.

	$ git review
	$ ssh-keygen -t rsa -N ''
	$ upload onap.pub to "https://gerrit.onap.org/r/#/settings/ssh-keys"
      If review fail, we can run below command to debug
	  $ ssh -vv -p 29418 haibin@gerrit.onap.org
        Hi Huang Haibin, you have successfully connected over SSH.


git review 包含以下工作：

- 检查是否可以访问到远程库 
- 如果不能，提示输入username后重试 
- 创建一个名为”gerrit“的节点指向Gerrit 
- 安装commit-msg这个钩子 

如果 git review 被拒的话，执行下面的操作重新提交

	$ git commit -s --amend
	$ git review


### 5.3 setup developing env
https://wiki.onap.org/display/DW/Developing+ONAP 

## others

see ocata code

mso -> multi-cloud -> openstack






